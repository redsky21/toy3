name: Deploy to Remote Server

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: windows-latest
    steps:
      - name: Checkout the code
        uses: actions/checkout@v2

      - name: Set up JDK 17
        uses: actions/setup-java@v1
        with:
          java-version: 17

      - name: Build with Maven
        run: mvn -B package --file pom.xml

      - name: Add SSH key
        uses: webfactory/ssh-agent@v0.4.0
        with:
          ssh-private-key: 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

      - name: Connect to Remote Server via SSH
        run: ssh -i ${{ secrets.SSH_PRIVATE_KEY_PATH }} -o StrictHostKeyChecking=no ${{ secrets.REMOTE_USERNAME }}@${{ secrets.REMOTE_HOST }} -p ${{ secrets.SSH_PORT }}

      - name: Upload artifact to remote server
        run: scp -r -i ${{ secrets.SSH_PRIVATE_KEY_PATH }} -P ${{ secrets.SSH_PORT }} target/toy3-0.0.1-SNAPSHOT.jar ${{ secrets.REMOTE_USERNAME }}@${{ secrets.REMOTE_HOST }}:/home/user/toy3-0.0.1-SNAPSHOT.jar

      - name: Restart the service
        run: ssh -i ${{ secrets.SSH_PRIVATE_KEY_PATH }} -o StrictHostKeyChecking=no ${{ secrets.REMOTE_USERNAME }}@${{ secrets.REMOTE_HOST }} -p ${{ secrets.SSH_PORT }} "sudo systemctl restart my-app.service"
